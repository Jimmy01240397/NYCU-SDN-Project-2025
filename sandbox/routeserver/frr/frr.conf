frr version 10.5.0
frr defaults traditional
hostname 1a6454abad17
log syslog informational
fpm connection ip ${DUMMY_PREFIX_V4}.2 port 2620
service integrated-vtysh-config
!
ip prefix-list AS65${ID}0 seq 5 permit ${LAN_PREFIX_V4}.${ID}.0/24 le 24
ip prefix-list AS65${ID}1 seq 5 permit ${TRANSIT_PREFIX_V4}.${ID}.0/24 le 24
!
ipv6 prefix-list AS65${ID}0 seq 5 permit ${LAN_PREFIX_V6}:${ID}::/64 le 64
ipv6 prefix-list AS65${ID}1 seq 5 permit ${TRANSIT_PREFIX_V6}${ID}::/64 le 64
!
ip prefix-list AS65${LEFT_ID}0 seq 5 permit ${LAN_PREFIX_V4}.${LEFT_ID}.0/24 le 24
ip prefix-list AS65${LEFT_ID}1 seq 5 permit ${TRANSIT_PREFIX_V4}.${LEFT_ID}.0/24 le 24
!
ipv6 prefix-list AS65${LEFT_ID}0 seq 5 permit ${LAN_PREFIX_V6}:${LEFT_ID}::/64 le 64
ipv6 prefix-list AS65${LEFT_ID}1 seq 5 permit ${TRANSIT_PREFIX_V6}${LEFT_ID}::/64 le 64
!
ip prefix-list AS65${RIGHT_ID}0 seq 5 permit ${LAN_PREFIX_V4}.${RIGHT_ID}.0/24 le 24
ip prefix-list AS65${RIGHT_ID}1 seq 5 permit ${TRANSIT_PREFIX_V4}.${RIGHT_ID}.0/24 le 24
!
ipv6 prefix-list AS65${RIGHT_ID}0 seq 5 permit ${LAN_PREFIX_V6}:${RIGHT_ID}::/64 le 64
ipv6 prefix-list AS65${RIGHT_ID}1 seq 5 permit ${TRANSIT_PREFIX_V6}${RIGHT_ID}::/64 le 64
!
route-map taix-out permit 5
 match ip address prefix-list AS65${ID}0
exit
!
route-map taix-out permit 10
 match ipv6 address prefix-list AS65${ID}0
exit
!
route-map taix-out permit 15
 match ip address prefix-list AS65${ID}1
exit
!
route-map taix-out permit 20
 match ipv6 address prefix-list AS65${ID}1
exit
!
route-map taix-out deny 99
exit
!
route-map taix-in deny 5
 match ip address prefix-list AS65${ID}0
exit
!
route-map taix-in deny 10
 match ipv6 address prefix-list AS65${ID}0
exit
!
route-map taix-in deny 15
 match ip address prefix-list AS65${ID}1
exit
!
route-map taix-in deny 20
 match ipv6 address prefix-list AS65${ID}1
exit
!
route-map taix-in permit 50
exit
!
route-map taix-in deny 99
exit
!
route-map transit-out permit 50
exit
!
route-map transit-out deny 99
exit
!
route-map transit-in permit 5
 match ip address prefix-list AS65${ID}1
exit
!
route-map transit-in permit 10
 match ipv6 address prefix-list AS65${ID}1
exit
!
route-map transit-in deny 99
exit
!
route-map left-out permit 5
 match ip address prefix-list AS65${ID}0
exit
!
route-map left-out permit 10
 match ipv6 address prefix-list AS65${ID}0
exit
!
route-map left-out permit 15
 match ip address prefix-list AS65${ID}1
exit
!
route-map left-out permit 20
 match ipv6 address prefix-list AS65${ID}1
exit
!
route-map left-out deny 99
exit
!
route-map left-in permit 5
 match ip address prefix-list AS65${LEFT_ID}0
exit
!
route-map left-in permit 10
 match ipv6 address prefix-list AS65${LEFT_ID}0
exit
!
route-map left-in permit 15
 match ip address prefix-list AS65${LEFT_ID}1
exit
!
route-map left-in permit 20
 match ipv6 address prefix-list AS65${LEFT_ID}1
exit
!
route-map left-in deny 99
exit
!
route-map right-out permit 5
 match ip address prefix-list AS65${ID}0
exit
!
route-map right-out permit 10
 match ipv6 address prefix-list AS65${ID}0
exit
!
route-map right-out permit 15
 match ip address prefix-list AS65${ID}1
exit
!
route-map right-out permit 20
 match ipv6 address prefix-list AS65${ID}1
exit
!
route-map right-out deny 99
exit
!
route-map right-in permit 5
 match ip address prefix-list AS65${RIGHT_ID}0
exit
!
route-map right-in permit 10
 match ipv6 address prefix-list AS65${RIGHT_ID}0
exit
!
route-map right-in permit 15
 match ip address prefix-list AS65${RIGHT_ID}1
exit
!
route-map right-in permit 20
 match ipv6 address prefix-list AS65${RIGHT_ID}1
exit
!
route-map right-in deny 99
exit
!
ip router-id ${IX_PREFIX_V4}.${ID}
!
router bgp 65${ID}0
 bgp router-id ${IX_PREFIX_V4}.${ID}
 no bgp hard-administrative-reset
 no bgp default ipv4-unicast
 no bgp graceful-restart notification
 neighbor ${IX_PREFIX_V4}.253 remote-as 65000
 neighbor ${IX_PREFIX_V4}.253 description taix
 neighbor ${IX_PREFIX_V4}.253 password winlab.nycu
 neighbor ${TRANSIT_LINK_PREFIX_V4}.2 remote-as 65${ID}1
 neighbor ${TRANSIT_LINK_PREFIX_V4}.2 description transit
 neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} remote-as 65${LEFT_ID}0
 neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} description left
 neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} remote-as 65${RIGHT_ID}0
 neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} description right
 neighbor ${IX_PREFIX_V6}::fe remote-as 65000
 neighbor ${IX_PREFIX_V6}::fe description taix
 neighbor ${IX_PREFIX_V6}::fe password winlab.nycu
 neighbor ${TRANSIT_LINK_PREFIX_V6}::2 remote-as 65${ID}1
 neighbor ${TRANSIT_LINK_PREFIX_V6}::2 description transit
 neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} remote-as 65${LEFT_ID}0
 neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} description left
 neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} remote-as 65${RIGHT_ID}0
 neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} description right
 !
 address-family ipv4 unicast
  network ${LAN_PREFIX_V4}.${ID}.0/24
  neighbor ${IX_PREFIX_V4}.253 activate
  neighbor ${IX_PREFIX_V4}.253 weight 900
  neighbor ${IX_PREFIX_V4}.253 route-map taix-in in
  neighbor ${IX_PREFIX_V4}.253 route-map taix-out out
  neighbor ${TRANSIT_LINK_PREFIX_V4}.2 activate
  neighbor ${TRANSIT_LINK_PREFIX_V4}.2 weight 1000
  neighbor ${TRANSIT_LINK_PREFIX_V4}.2 route-map transit-in in
  neighbor ${TRANSIT_LINK_PREFIX_V4}.2 route-map transit-out out
  neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} activate
  neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} weight 1000
  neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} route-map left-in in
  neighbor ${LEFT_PREFIX_V4}.${LEFT_ID} route-map left-out out
  neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} activate
  neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} weight 1000
  neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} route-map right-in in
  neighbor ${RIGHT_PREFIX_V4}.${RIGHT_ID} route-map right-out out
 exit-address-family
 !
 address-family ipv6 unicast
  network ${LAN_PREFIX_V6}:${ID}::/64
  neighbor ${IX_PREFIX_V6}::fe activate
  neighbor ${IX_PREFIX_V6}::fe weight 900
  neighbor ${IX_PREFIX_V6}::fe route-map taix-in in
  neighbor ${IX_PREFIX_V6}::fe route-map taix-out out
  neighbor ${TRANSIT_LINK_PREFIX_V6}::2 activate
  neighbor ${TRANSIT_LINK_PREFIX_V6}::2 weight 1000
  neighbor ${TRANSIT_LINK_PREFIX_V6}::2 route-map transit-in in
  neighbor ${TRANSIT_LINK_PREFIX_V6}::2 route-map transit-out out
  neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} activate
  neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} weight 1000
  neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} route-map left-in in
  neighbor ${LEFT_PREFIX_V6}::${LEFT_ID} route-map left-out out
  neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} activate
  neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} weight 1000
  neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} route-map right-in in
  neighbor ${RIGHT_PREFIX_V6}::${RIGHT_ID} route-map right-out out
 exit-address-family
exit
!
